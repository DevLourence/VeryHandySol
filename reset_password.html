<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password | VeryHandy Solution</title>
    <link rel="icon" href="image/logo/logo.svg" type="image/svg+xml">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        purple: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb', // Brand Primary
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        },
                        amber: {
                            400: '#38bdf8', // Brand Secondary
                            500: '#0ea5e9',
                            600: '#0284c7',
                        }
                    }
                }
            }
        }
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
        }

        .glass {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }

        /* --- MODERN MODAL STYLES --- */
        .modal-overlay {
            position: fixed;
            inset: 0;
            z-index: 9999;
            background: rgba(15, 23, 42, 0.4);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-container {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 40px;
            width: 100%;
            max-width: 440px;
            padding: 2.5rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
            text-align: center;
            transform: scale(0.9) translateY(20px);
            transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .modal-overlay.active .modal-container {
            transform: scale(1) translateY(0);
        }

        .modal-icon-wrapper {
            width: 80px;
            height: 80px;
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            margin: 0 auto 1.5rem;
            position: relative;
        }

        .modal-icon-wrapper::before {
            content: '';
            position: absolute;
            inset: 0;
            opacity: 0.15;
            background: currentColor;
            border-radius: inherit;
        }

        .modal-success .modal-icon-wrapper {
            color: #10b981;
        }

        .modal-danger .modal-icon-wrapper {
            color: #f43f5e;
        }

        .modal-warning .modal-icon-wrapper {
            color: #f59e0b;
        }

        .modal-info .modal-icon-wrapper {
            color: #6366f1;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 900;
            color: #0f172a;
            margin-bottom: 0.75rem;
            letter-spacing: -0.025em;
            text-transform: uppercase;
        }

        .modal-message {
            font-size: 0.9375rem;
            line-height: 1.6;
            color: #64748b;
            margin-bottom: 2rem;
            font-weight: 500;
        }

        .modal-btns {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .modal-btn {
            flex: 1;
            padding: 1.25rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            cursor: pointer;
            border: none;
        }

        .btn-cancel {
            background: #f1f5f9;
            color: #64748b;
            border: 1px solid #e2e8f0;
        }

        .btn-cancel:hover {
            background: #e2e8f0;
            color: #0f172a;
        }

        .modal-btns {
            display: flex;
            gap: 1rem;
        }

        .modal-btn {
            flex: 1;
            padding: 1.25rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            cursor: pointer;
            border: none;
        }

        .btn-confirm {
            color: white;
            box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>

<body class="bg-slate-50 min-h-screen flex items-center justify-center p-6">
    <div class="glass w-full max-w-md p-10 rounded-[40px] shadow-2xl border border-white text-center">
        <div class="w-20 h-20 mx-auto mb-6 bg-white rounded-full p-1 shadow-lg cursor-pointer"
            onclick="window.location.href='https://vh-autoglass.com'">
            <img src="image/logo/vh_logo.png" class="w-full h-full rounded-full object-cover">
        </div>
        <h1 class="text-3xl font-black text-purple-600 uppercase mb-2 tracking-tighter cursor-pointer"
            onclick="window.location.href='https://vh-autoglass.com'">VeryHandy Solution</h1>
        <p class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-10">Security Protocol</p>

        <div id="reset-view">
            <h2 class="text-xl font-black text-slate-800 uppercase mb-4 tracking-tight">Define New Password</h2>
            <form id="form-reset" class="space-y-4">
                <input type="password" id="pass" placeholder="New Secure Password" required
                    class="w-full p-4 bg-slate-100 rounded-2xl border-none outline-none focus:ring-2 focus:ring-purple-600 font-bold transition">
                <input type="password" id="pass-confirm" placeholder="Confirm Password" required
                    class="w-full p-4 bg-slate-100 rounded-2xl border-none outline-none focus:ring-2 focus:ring-purple-600 font-bold transition">
                <button type="submit" id="btn-submit"
                    class="w-full bg-purple-600 text-white font-black py-4 rounded-2xl uppercase tracking-widest text-xs shadow-xl hover:bg-slate-900 transition-all transform hover:-translate-y-1">Apply
                    Security Upgrade</button>
            </form>
        </div>

        <div id="error-view" class="hidden">
            <h2 class="text-xl font-black text-red-600 uppercase mb-4">Link Expired</h2>
            <p class="text-slate-500 mb-8 text-sm font-medium">This recovery link is invalid or has timed out.</p>
            <a href="index.html"
                class="block bg-slate-900 text-white font-black py-4 rounded-2xl uppercase text-[10px] tracking-widest transition transform hover:scale-105">Return
                to Homepage</a>
        </div>
    </div>
    <!-- Modern UI Modal -->
    <div id="ui-modal" class="modal-overlay">
        <div class="modal-container">
            <div id="modal-icon-container" class="modal-icon-wrapper"></div>
            <h3 id="ui-modal-title" class="modal-title"></h3>
            <p id="ui-modal-msg" class="modal-message"></p>
            <div id="modal-actions" class="modal-btns">
                <button id="modal-cancel" class="modal-btn btn-cancel hidden">Cancel</button>
                <button id="modal-confirm" class="modal-btn">OK</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // --- SUPABASE CONFIG ---
        const SUPABASE_URL = 'https://imvgiqlhpaeotevsffaf.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImltdmdpcWxocGFlb3RldnNmZmFmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk0Nzg4MjMsImV4cCI6MjA4NTA1NDgyM30.X0n2IadDlJvgWM9gsV9lK0o2qPN1qnI06hZRD6PL3X8';

        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        async function init() {
            // Supabase automatically handles the recovery session if the user arrives from a reset link
            const { data, error } = await _supabase.auth.getSession();

            if (error || !data.session) {
                document.getElementById('reset-view').classList.add('hidden');
                document.getElementById('error-view').classList.remove('hidden');
            }
        }

        document.getElementById('form-reset').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('btn-submit');
            const p1 = document.getElementById('pass').value;
            const p2 = document.getElementById('pass-confirm').value;

            if (p1 !== p2) return showNiceModal({ title: 'Mismatch', message: 'Passwords do not align.', type: 'warning' });
            if (p1.length < 6) return showNiceModal({ title: 'Weak Password', message: 'Password must be at least 6 characters.', type: 'warning' });

            btn.disabled = true;
            btn.innerText = "UPGRADING SECURITY...";

            try {
                const { error } = await _supabase.auth.updateUser({ password: p1 });

                if (error) throw error;

                await showNiceModal({ title: 'Security Updated', message: 'Successful parameters updated. Proceeding to login.', type: 'success' });
                // Sign out to force re-login with new password
                await _supabase.auth.signOut();
                window.location.href = 'index.html';
            } catch (err) {
                showNiceModal({ title: 'Upgrade Failed', message: err.message, type: 'danger' });
                btn.disabled = false;
                btn.innerText = "Apply Security Upgrade";
            }
        });

        async function showNiceModal({ title, message, type = 'info', confirmText = 'OK' }) {
            return new Promise((resolve) => {
                const modal = document.getElementById('ui-modal');
                const titleEl = document.getElementById('ui-modal-title');
                const msgEl = document.getElementById('ui-modal-msg');
                const iconContainer = document.getElementById('modal-icon-container');
                const confirmBtn = document.getElementById('modal-confirm');

                modal.className = 'modal-overlay active ' + `modal-${type}`;
                titleEl.innerText = title;
                msgEl.innerText = message;
                confirmBtn.innerText = confirmText;

                const icons = {
                    success: '<i class="fa-solid fa-circle-check"></i>',
                    danger: '<i class="fa-solid fa-triangle-exclamation"></i>',
                    warning: '<i class="fa-solid fa-circle-exclamation"></i>',
                    info: '<i class="fa-solid fa-circle-info"></i>'
                };
                iconContainer.innerHTML = icons[type] || icons.info;

                const btnColors = {
                    success: 'bg-emerald-500 hover:bg-emerald-600 shadow-emerald-500/20',
                    danger: 'bg-rose-500 hover:bg-rose-600 shadow-rose-500/20',
                    warning: 'bg-amber-500 hover:bg-amber-600 shadow-amber-500/20',
                    info: 'bg-purple-600 hover:bg-purple-700 shadow-purple-500/20'
                };
                confirmBtn.className = `modal-btn text-white shadow-lg transition-all ${btnColors[type] || btnColors.info}`;

                // Handle cancel button if needed (though not used in this file yet)
                const cancelBtn = document.getElementById('modal-cancel');
                if (cancelBtn) {
                    if (cancelText) {
                        cancelBtn.innerText = cancelText;
                        cancelBtn.className = 'modal-btn btn-cancel';
                        cancelBtn.classList.remove('hidden');
                    } else {
                        cancelBtn.classList.add('hidden');
                    }
                }

                confirmBtn.onclick = () => { modal.classList.remove('active'); resolve(true); };
            });
        }

        init();
    </script>
</body>

</html>